import pandas as pd
from pandas_datareader import data, wb
import fix_yahoo_finance as yf
yf.pdr_override()
import datetime
import numpy as np
from datetime import timedelta
from sqlalchemy import create_engine


#To get data:


ticker = ['IBM',
'ICE',
'IDXX',
'IFF',
'ILMN',
'INCY',
'INFO',
'INTC',
'INTU',
'IP',
'IPG',
'IQV',
'IR',
'IRM',
'ISRG',
'IT',
'ITW',
'IVZ',
'JBHT',
'JCI',
'JEC',
'JNJ',
'JNPR',
'JPM',
'JWN',
'K',
'KEY',
'KHC',
'KIM',
'KLAC',
'KMB',
'KMI',
'KMX',
'KO',
'KORS',
'KR',
'KSS',
'KSU',
'L',
'LB',
'LEG',
'LEN',
'LH',
'LKQ',
'LLL',
'LLY',
'LMT',
'LNC',
'LNT',
'LOW',
'LRCX',
'LUK',
'LUV',
'LYB',
'M',
'MA',
'MAA',
'MAC',
'MAR',
'MAS',
'MAT',
'MCD',
'MCHP',
'MCK',
'MCO',
'MDLZ',
'MDT',
'MET',
'MGM',
'MHK',
'MKC',
'MLM',
'MMC',
'MMM',
'MNST',
'MO',
'MON',
'MOS',
'MPC',
'MRK',
'MRO',
'MS',
'MSFT',
'MSI',
'MTB',
'MTD',
'MU',
'MYL',
'NAVI',
'NBL',
'NCLH',
'NDAQ',
'NEE',
'NEM',
'NFLX',
'NFX',
'NI',
'NKE',
'NLSN',
'NOC',
'NOV',
'NRG',
'NSC',
'NTAP',
'NTRS',
'NUE',
'NVDA',
'NWL',
'NWS',
'NWSA',
'O',
'OKE',
'OMC',
'ORCL',
'ORLY',
'OXY',
'PAYX',
'PBCT',
'PCAR',
'PCG',
'PCLN',
'PDCO',
'PEG',
'PEP',
'PFE',
'PFG',
'PG',
'PGR',
'PH',
'PHM',
'PKG',
'PKI',
'PLD',
'PM',
'PNC',
'PNR',
'PNW',
'PPG',
'PPL',
'PRGO',
'PRU',
'PSA',
'PSX',
'PVH',
'PWR',
'PX',
'PXD',
'PYPL',
'QCOM',
'QRVO',
'RCL',
'RE',
'REG',
'REGN',
'RF',
'RHI',
'RHT',
'RJF',
'RL',
'RMD',
'ROK',
'ROP',
'ROST',
'RRC',
'RSG',
'RTN',
'SBAC',
'SBUX',
'SCG',
'SCHW',
'SEE',
'SHW',
'SIG',
'SJM',
'SLB',
'SLG',
'SNA',
'SNI',
'SNPS',
'SO',
'SPG',
'SPGI',
'SRCL',
'SRE',
'STI',
'STT',
'STX',
'STZ',
'SWK',
'SWKS',
'SYF',
'SYK',
'SYMC',
'SYY',
'T',
'TAP',
'TDG',
'TEL',
'TGT',
'TIF',
'TJX',
'TMK',
'TMO',
'TPR',
'TRIP',
'TROW',
'TRV',
'TSCO',
'TSN',
'TSS',
'TWX',
'TXN',
'TXT',
'UA',
'UAA',
'UAL',
'UDR',
'UHS',
'ULTA',
'UNH',
'UNM',
'UNP',
'UPS',
'URI',
'USB',
'UTX',
'V',
'VAR',
'VFC',
'VIAB',
'VLO',
'VMC',
'VNO',
'VRSK',
'VRSN',
'VRTX',
'VTR',
'VZ',
'WAT',
'WBA',
'WDC',
'WEC',
'WFC',
'WHR',
'WLTW',
'WM',
'WMB',
'WMT',
'WRK',
'WU',
'WY',
'WYN',
'WYNN',
'XEC',
'XEL',
'XL',
'XLNX',
'XOM',
'XRAY',
'XRX',
'XYL',
'YUM',
'ZBH',
'ZION',
'ZTS']

start = datetime.date.today() - timedelta(days=1)
end = datetime.date.today() - timedelta(days=1)
df = data.get_data_yahoo(ticker, start, end)

##stacks data so that it is in the proper format
df1 = df.stack()

## find the indexes and 
df2 = df1.reset_index()

dfNew = df2.rename(columns = {'level_1' : 'TickerSymbol'})

##dfNew.to_csv('datadaily.txt', sep= '\t', index = False)


eng = create_engine('mssql+pyodbc://fin5350:aggies2018@stairway.usu.edu/5350fin?driver=SQL Server')

dfNew.to_sql('SP500_daily', eng, index = False, if_exists = 'append')
