import pandas as pd
from pandas_datareader import data, wb
import fix_yahoo_finance as yf
yf.pdr_override()
import datetime
import numpy as np
from datetime import timedelta
from sqlalchemy import create_engine


#To get data:


ticker = ['A',
'AAL',
'AAP',
'AAPL',
'ABBV',
'ABC',
'ABT',
'ACN',
'ADBE',
'ADI',
'ADM',
'ADP',
'ADS',
'ADSK',
'AEE',
'AEP',
'AES',
'AET',
'AFL',
'AGN',
'AIG',
'AIV',
'AIZ',
'AJG',
'AKAM',
'ALB',
'ALGN',
'ALK',
'ALL',
'ALLE',
'ALXN',
'AMAT',
'AMD',
'AME',
'AMG',
'AMGN',
'AMP',
'AMT',
'AMZN',
'ANDV',
'ANSS',
'ANTM',
'AON',
'AOS',
'APA',
'APC',
'APD',
'APH',
'APTV',
'ARE',
'ARNC',
'ATVI',
'AVB',
'AVGO',
'AVY',
'AWK',
'AXP',
'AYI',
'AZO',
'BA',
'BAC',
'BAX',
'BBT',
'BBY',
'BDX',
'BEN',
'BF.B',
'BHF',
'BHGE',
'BIIB',
'BK',
'BLK',
'BLL',
'BMY',
'BRK.B',
'BSX',
'BWA',
'BXP',
'C',
'CA',
'CAG',
'CAH',
'CAT',
'CB',
'CBG',
'CBOE',
'CBS',
'CCI',
'CCL',
'CDNS',
'CELG',
'CERN',
'CF',
'CFG',
'CHD',
'CHK',
'CHRW',
'CHTR',
'CI',
'CINF',
'CL',
'CLX',
'CMA',
'CMCSA',
'CME',
'CMG',
'CMI',
'CMS',
'CNC',
'CNP',
'COF',
'COG',
'COL',
'COO',
'COP',
'COST',
'COTY',
'CPB',
'CRM',
'CSCO',
'CSRA',
'CSX',
'CTAS',
'CTL',
'CTSH',
'CTXS',
'CVS',
'CVX',
'CXO',
'D',
'DAL',
'DE',
'DFS',
'DG',
'DGX',
'DHI',
'DHR',
'DIS',
'DISCA',
'DISCK',
'DISH',
'DLR',
'DLTR',
'DOV',
'DPS',
'DRE',
'DRI',
'DTE',
'DUK',
'DVA',
'DVN',
'DWDP',
'DXC',
'EA',
'EBAY',
'ECL',
'ED',
'EFX',
'EIX',
'EL',
'EMN',
'EMR',
'EOG',
'EQIX',
'EQR',
'EQT',
'ES',
'ESRX',
'ESS',
'ETFC',
'ETN',
'ETR',
'EVHC',
'EW',
'EXC',
'EXPD',
'EXPE',
'EXR',
'F',
'FAST',
'FB',
'FBHS',
'FCX',
'FDX',
'FE',
'FFIV',
'FIS',
'FISV',
'FITB',
'FL',
'FLIR',
'FLR',
'FLS',
'FMC',
'FOX',
'FOXA',
'FRT',
'FTI',
'FTV',
'GD',
'GE',
'GGP',
'GILD',
'GIS',
'GLW',
'GM',
'GOOG',
'GOOGL',
'GPC',
'GPN',
'GPS',
'GRMN',
'GS',
'GT',
'GWW',
'HAL',
'HAS',
'HBAN',
'HBI',
'HCA',
'HCN',
'HCP',
'HD',
'HES',
'HIG',
'HII',
'HLT',
'HOG',
'HOLX',
'HON',
'HP',
'HPE',
'HPQ',
'HRB',
'HRL',
'HRS',
'HSIC',
'HST',
'HSY',
'HUM']

start = datetime.datetime.today() - timedelta(days=1)
end = datetime.datetime.today() - timedelta(days=1)
df = data.get_data_yahoo(ticker, start, end)

##stacks data so that it is in the proper format
df1 = df.stack()

## find the indexes and 
df2 = df1.reset_index()

dfNew = df2.rename(columns = {'level_1' : 'TickerSymbol'})

##dfNew.to_csv('datadaily.txt', sep= '\t', index = False)


eng = create_engine('mssql+pyodbc://stephenbreeze:sbre8733@stairway.usu.edu/stephenbreeze?driver=SQL Server')

dfNew.to_sql('SP500_daily', eng, index = False, if_exists = 'append')
